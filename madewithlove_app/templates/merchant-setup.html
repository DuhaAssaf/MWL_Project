{% extends 'base.html' %}
{% load static %}
{% block title %}{{ profile.is_profile_complete|yesno:"Edit Your Profile,Setup Your Profile" }}{% endblock %}

{% block content %}
<div class="card shadow p-4 border-0 rounded-4">
    <div class="container mt-5">
        <h2 class="text-center text-warning mb-4">
            {% if profile.is_profile_complete %}
                Edit Your Store Profile
            {% else %}
                Welcome, {{ request.session.username|default:"User" }} â€” Complete Your Profile Please
            {% endif %}
        </h2>

        {% if error %}
            <div class="alert alert-danger text-center">{{ error }}</div>
        {% endif %}

        <form method="POST" enctype="multipart/form-data" id="profileForm" novalidate>
            {% csrf_token %}

            <!-- Profile Picture -->
            <div class="mb-3">
                <label>Profile Picture</label>
                <input type="file" name="profile_picture" class="form-control" id="profilePictureInput">
                <div class="mt-3 text-center">
                    {% if profile.profile_picture %}
                        <img id="profilePreview" src="{{ profile.profile_picture.url }}" alt="Profile Picture"
                             class="img-fluid rounded" style="max-width: 200px;">
                    {% else %}
                        <img id="profilePreview" src="#" alt="Profile Preview"
                             class="img-fluid rounded" style="max-width: 200px; display: none;">
                    {% endif %}
                </div>
            </div>

            <!-- Store Name -->
            <div class="mb-3">
                <label>Store Name</label>
                <input type="text" name="store_name" class="form-control" required minlength="6"
                       value="{{ profile.store_name }}">
                       <div class="mt-3 text-center">
                        {% if profile.store.store_logo %}
                            <img id="storePreview" src="{{ profile.store.store_logo.url }}" alt="logo Picture"
                                 class="img-fluid rounded" style="max-width: 200px;">
                        {% else %}
                            <img id="storePreview" src="#" alt="store Preview"
                                 class="img-fluid rounded" style="max-width: 200px; display: none;">
                        {% endif %}
                    </div>
    
            </div>

            <!-- Store Logo -->
            <div class="mb-3">
                <label>Store Picture</label>
                <input type="file" name="store_logo" class="form-control" id="storeLogoInput">
                <div class="mt-3 text-center">
                    {% if profile.store and profile.store.store_logo %}
                        <img id="storeLogoPreview" src="{{ profile.store.store_logo.url }}" alt="Store Logo"
                             class="img-fluid rounded" style="max-width: 200px;">
                    {% else %}
                        <img id="storeLogoPreview" src="#" alt="Store Logo Preview"
                             class="img-fluid rounded" style="max-width: 200px; display: none;">
                    {% endif %}
                </div>
            </div>

            <!-- Category -->
            <div class="mb-3">
                <label>Category</label>
                <select name="category" class="form-select" required>
                    <option value="">Select a category</option>
                    {% for category in categories %}
                        <option value="{{ category.slug }}"
                            {% if profile.store and profile.store.category.slug == category.slug %}selected{% endif %}>
                            {{ category }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Description -->
            <div class="mb-3">
                <label>Description</label>
                <textarea name="description" class="form-control" rows="3" required minlength="15">{{ profile.description }}</textarea>
            </div>

            <!-- Payout Method -->
            <div class="mb-3">
                <label>Payout Method (Optional)</label>
                <input type="text" name="payout_method" class="form-control" value="{{ profile.payout_method }}">
            </div>

            <!-- Payout Email -->
            <div class="mb-3">
                <label>Payout Email</label>
                <input type="email" name="payout_email" class="form-control" required value="{{ profile.payout_email }}">
            </div>

            <!-- Country -->
            <div class="mb-3">
                <label>Country</label>
                <input type="text" name="country" class="form-control" required value="{{ profile.country }}">
            </div>

            <!-- Submit -->
            <button type="submit" class="btn btn-primary w-100">
                {% if profile.is_profile_complete %}
                    Update Profile
                {% else %}
                    Save and Continue
                {% endif %}
            </button>
        </form>
    </div>
</div>

<!-- External Scripts -->
<link rel="stylesheet" href="{% static 'css/merchant.css' %}">
<script src="{% static 'js/merchant.js' %}"></script>
{% endblock %}
